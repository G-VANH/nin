<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Valentine Nguyễn Thủy Ninh - 24/7 365</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        canvas { display: block; }
        
        /* Lớp phủ bắt đầu */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); color: white;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; cursor: pointer; font-family: 'Arial', sans-serif;
        }
        #overlay h2 { color: #ff1a4a; margin-bottom: 10px; }
        #overlay p { font-size: 14px; opacity: 0.8; }
    </style>
    <title>Perfect 3D Heart Shape</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background-color: #000; 
            display: flex; justify-content: center; align-items: center;
        }
        canvas { display: block; }
    </style>

</head>
<body>
<div id="overlay">
    <h2>Dành cho Nguyễn Thủy Ninh ❤️</h2>
    <p>Chạm vào màn hình để bắt đầu...</p>
</div>

<audio id="bgMusic" loop>
    <source src="https://files.catbox.moe/978v1o.mp3" type="audio/mpeg">
</audio>

<canvas id="heartCanvas"></canvas>

<script>
const canvas = document.getElementById('heartCanvas');
const ctx = canvas.getContext('2d');
const music = document.getElementById('bgMusic');
const overlay = document.getElementById('overlay');
// Kích hoạt nhạc và ẩn overlay
overlay.addEventListener('click', () => {
    music.play();
    overlay.style.display = 'none';
});

const dpr = window.devicePixelRatio || 1;
function resize() {
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    ctx.scale(dpr, dpr);
}
window.addEventListener('resize', resize);
resize();

let particles = [];
const countCore = 22000;
const countVeil = 8000;
const countHalo = 4000;
let time = 0;

function createCache(color, glow, size, blur) {
    const c = document.createElement('canvas');
    c.width = 32 * dpr; c.height = 32 * dpr;
    const _ctx = c.getContext('2d');
    _ctx.fillStyle = color;
    _ctx.shadowBlur = blur * dpr;
    _ctx.shadowColor = glow;
    _ctx.beginPath();
    _ctx.arc(16 * dpr, 16 * dpr, size * dpr, 0, Math.PI * 2);
    _ctx.fill();
    return c;
}

const cacheCore = createCache('#ff1a4a', '#ff0022', 2.8, 14); 
const cacheVeil = createCache('#ff4d79', '#ff1a4a', 1.2, 5);
const cacheHalo = createCache('#ffffff', '#ff4d79', 0.8, 3);

// --- CÔNG THỨC TRÁI TIM CẢI TIẾN: LÀM ĐẸP PHẦN ĐỈNH ---
function getPerfect3DHeart(u, v) {
    // u: 0 -> PI, v: 0 -> 2PI
    // Tinh chỉnh sin(u) và thêm hệ số để phần trên phồng hơn và khe sâu hơn
    const sinU = Math.sin(u);
    const cosU = Math.cos(u);
    
    let x = 16 * Math.pow(sinU, 3) * Math.sin(v);
    
    // Chỉnh sửa công thức Y để tạo độ cong "vai" tròn và khe đỉnh sâu
    let y = -(13 * cosU - 5 * Math.cos(2 * u) - 2 * Math.cos(3 * u) - Math.cos(4 * u));
    
    // Thêm một chút điều chỉnh y dựa trên x để làm khe đỉnh rõ hơn
    y += Math.abs(x) * 0.05; 

    let z = 16 * Math.pow(sinU, 3) * Math.cos(v);
    
    return { x, y, z };
}

class Particle {
    constructor(type) {
        this.type = type;
        this.u = Math.random() * Math.PI;
        this.v = Math.random() * Math.PI * 2;
        const pos = getPerfect3DHeart(this.u, this.v);
        
        let baseDist, noiseRange;
        if (type === 'halo') {
            baseDist = 24 + Math.random() * 8;
            noiseRange = 6;
            this.cache = cacheHalo;
            this.alpha = Math.random() * 0.3 + 0.1;
        } else if (type === 'veil') {
            baseDist = 18 + Math.random() * 2;
            noiseRange = 3;
            this.cache = cacheVeil;
            this.alpha = Math.random() * 0.3 + 0.1;
        } else {
            baseDist = 13.5; // Tăng nhẹ kích thước lõi
            noiseRange = 1.2;
            this.cache = cacheCore;
            this.alpha = Math.random() * 0.8 + 0.2;
        }
        
        const noise = (Math.random() - 0.5) * noiseRange;
        this.x = pos.x * (baseDist + noise);
        this.y = pos.y * (baseDist + noise);
        this.z = pos.z * (baseDist + noise);
    }

    draw(pulseScale) {
        const finalScale = this.type === 'halo' ? (1 + (pulseScale - 1) * 0.4) : pulseScale;
        
        const x3d = this.x * finalScale;
        const y3d = this.y * finalScale;
        const z3d = this.z * finalScale;

        const perspective = 700 / (700 - z3d); 
        const screenX = (window.innerWidth / 2) + x3d * perspective;
        // Chỉnh offset Y để căn giữa chuẩn hơn (+35)
        const screenY = (window.innerHeight / 2) + (y3d + 35) * perspective;

        ctx.globalAlpha = this.alpha;
        const s = (this.type === 'core' ? 8.5 : (this.type === 'veil' ? 5 : 3.5)) * perspective;
        ctx.drawImage(this.cache, screenX - s / 2, screenY - s / 2, s, s);
    }
}

for (let i = 0; i < countCore; i++) particles.push(new Particle('core'));
for (let i = 0; i < countVeil; i++) particles.push(new Particle('veil'));
for (let i = 0; i < countHalo; i++) particles.push(new Particle('halo'));

function animate() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);

    time += 0.07; 
    const pulse = 1 + Math.pow(Math.sin(time * 1.8), 10) * 0.3;

    for (let i = 0; i < particles.length; i++) {
        particles[i].draw(pulse);
    }

    requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>